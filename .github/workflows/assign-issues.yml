name: "Assign Issues"

on:
    issue_comment:
        types: [created]
    schedule:
        # Run daily to handle automatic unassignments
        - cron: "0 0 * * *"
    workflow_dispatch:

jobs:
    assign:
        runs-on: ubuntu-22.04
        permissions:
            issues: write
            pull-requests: read
        steps:
            - uses: actions/checkout@v4

            - name: Assign / unassign
              uses: actions/github-script@v7
              env:
                  ASSIGN_CMD: /assign
                  UNASSIGN_CMD: /unassign

                  # Configurable limits
                  MAX_ASSIGNMENTS_PER_USER: "5"
                  MAX_ASSIGNEES_PER_ISSUE: "1"

                  # If a user has >= N merged PRs in the repo, they bypass the per-user assignment limit.
                  BYPASS_MERGED_PR_THRESHOLD: "10"

                  # Auto-unassign if no PR is raised within N days of assignment.
                  DEADLINE_DAYS: "7"

                  ENABLE_SUGGESTION: "true"
              with:
                  github-token: ${{ secrets.GITHUB_TOKEN }}
                  script: |
                      const main = require('./.github/scripts/assign-issues/index.js');
                      await main({ github, context, core });
