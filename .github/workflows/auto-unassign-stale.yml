name: Auto Unassign Stale Issues

on:
  schedule:
    - cron: '0 0 * * *'  # runs daily

permissions:
  issues: write

jobs:
  unassign_stale:
    runs-on: ubuntu-latest
    steps:
      - name: Unassign stale issues
        uses: actions/github-script@v7
        with:
          script: |
            const daysInactive = 14;
            const issues = await github.paginate(github.rest.issues.listForRepo, {
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open'
            });

            const now = new Date();
            for (const issue of issues) {
              if (issue.assignees.length > 0) {
                const updated = new Date(issue.updated_at);
                const diffDays = (now - updated) / (1000 * 60 * 60 * 24);
                if (diffDays > daysInactive) {
                  console.log(`Unassigning ${issue.number}`);
                  await github.rest.issues.removeAssignees({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: issue.number,
                    assignees: issue.assignees.map(a => a.login)
                  });
                }
              }
            }
